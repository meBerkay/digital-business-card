(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{4723:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var a=t(5155),r=t(2115),i=t(5695),n=t(2108),l=t(6874),d=t.n(l);function c(){let{data:e,status:s}=(0,n.useSession)(),t=(0,i.useRouter)(),l=(0,i.useSearchParams)(),[c,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(1),[x,h]=(0,r.useState)(0),[p,f]=(0,r.useState)(!0),[b,y]=(0,r.useState)(""),g=(0,r.useCallback)(async e=>{try{let s=await fetch("/api/cards/".concat(e));if(s.ok){let e=await s.json();o(e),h(e.price*m)}else y("Kart bilgileri alınamadı.")}catch(e){console.error("Error fetching card details:",e),y("Kart bilgileri alınırken bir hata oluştu.")}finally{f(!1)}},[m]);(0,r.useEffect)(()=>{if("loading"===s)return;if(!e)return void t.push("/auth/signin");let a=l.get("cardSlug");a?g(a):(y("Sipariş verilecek kart se\xe7ilmedi."),f(!1))},[e,s,t,l,g]);let j=async e=>{if(e.preventDefault(),f(!0),y(""),!c){y("Sipariş verilecek kart bulunamadı."),f(!1);return}try{let e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cardId:c.id,quantity:m,totalPrice:x})}),s=await e.json();e.ok?t.push("/order/success?orderId=".concat(s.order.id)):y(s.error||"Sipariş oluşturulurken bir hata oluştu.")}catch(e){y("Bir hata oluştu.")}finally{f(!1)}};return"loading"===s||p?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Y\xfckleniyor..."})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(d(),{href:"/",className:"text-2xl font-bold text-gray-900",children:"DigiKart"})}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)(d(),{href:"/dashboard",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Dashboard"})})]})})}),(0,a.jsx)("main",{className:"max-w-3xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Sipariş Oluştur"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Sipariş detaylarını kontrol edin ve tamamlayın."})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[b&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md mb-4",children:b}),c?(0,a.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Sipariş \xd6zeti"}),(0,a.jsxs)("div",{className:"border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Kartvizit Adı:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:c.name})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Birim Fiyat:"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["₺",c.price.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-700",children:"Adet"}),(0,a.jsx)("input",{type:"number",name:"quantity",id:"quantity",min:"1",value:m,onChange:e=>{let s=parseInt(e.target.value);s>0&&(u(s),c&&h(c.price*s))},className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,a.jsx)("div",{className:"border-t pt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"text-base font-medium text-gray-900",children:"Toplam Tutar"}),(0,a.jsxs)("p",{className:"text-base font-medium text-gray-900",children:["₺",x.toFixed(2)]})]})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:p,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:p?"Sipariş Oluşturuluyor...":"Siparişi Tamamla"})})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Sipariş detayları y\xfcklenemedi veya kart se\xe7ilmedi."}),(0,a.jsx)(d(),{href:"/dashboard",className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700",children:"Dashboard'a D\xf6n"})]})]})]})})]}):null}function o(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Y\xfckleniyor..."}),children:(0,a.jsx)(c,{})})}},5493:(e,s,t)=>{Promise.resolve().then(t.bind(t,4723))},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"notFound")&&t.d(s,{notFound:function(){return a.notFound}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var s=s=>e(e.s=s);e.O(0,[874,108,441,684,358],()=>s(5493)),_N_E=e.O()}]);